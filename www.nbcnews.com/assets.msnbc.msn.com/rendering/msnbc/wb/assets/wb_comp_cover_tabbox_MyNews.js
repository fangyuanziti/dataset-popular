var dxMY = {}; (function () { var $d = {}; var $def = false; var $w_o = ""; var $m_o = ""; var $s_o = ""; var $l_o = ""; var $h_o = ""; function parseForecast() { var remVisible = ($def || $d.weather == undefined) ? false : true; var fx = $d.weather || DBMgr.def.getData().weather; $w_o += '<div id="cell1" class="content sL-sR sL w1"><span class="label" id="label1"><a href="http://www.nbcnews.com/id/3032128/">Weather</a><span class="chnglink"><a href="' + Utils.dbx_Change('weather') + '" class="chng">Change</a>'; $w_o += '</span></span></div><div id="cell2" class="content w2 x1 sL-sR sR label-remove"><span class="label" id="label2"></span>'; $w_o += '<div><span class="weatherlabel">' + fx.city + '</span>'; $w_o += '<table class="wealoc" cellspacing="0" cellpadding="0"><thead><tr class="tablehead"><th scope="col">Date</th><th scope="col">Condition</th><th scope="col">Description</th><th scope="col">Hi/Lo Temperatures</th></tr></thead><tbody>'; for (var i = 0; i < 3; i++) { var w = fx.forecast[i]; w.hi = Utils.cleanDate(w.hi); w.lo = Utils.cleanDate(w.lo); w.day = Utils.commaCrop(w.day); w.text = w.text.replace(/(<b>|<\/b>)/g, ''); w.text = w.text.replace(/(<br\s??\/>)/g, ' '); $w_o += '<tr><td class="date">' + w.day + '</td>'; $w_o += '<td class="condition"><a href="/id/18665223" alt="Local weather page for ' + fx.city + '"><img src="http://media1.s-nbcnews.com/i/msnbc/Components/CSS/img/weather/WC' + w.cid + '_small'; $w_o += (remVisible == false) ? '_bw' : ''; $w_o += '.jpg" alt="' + w.cond + '" title="' + w.text + '" /></a></td>'; $w_o += '<td class="cond">' + w.cond + '</td>'; var tp = (w.hi != '') ? (w.hi + ' / ' + w.lo) : (w.lo); $w_o += '<td class="temps">' + tp + '</td></tr>'; }; $w_o += '</tbody></table></div><p><a href="/id/18665223" alt="Local weather page for ' + fx.city + '">Extended forecast</a> provided by <a href="http://msnbc.weather.com/newscenter/fcstsummary.html?par=msnbc&site=msnbc.com&promo=0&cm_ven=MSNBC&cm_cat=www.msnbc.com&cm_pla=WxPage&cm_ite=CityPage" target="_blank">Weather.com&#174;</a></p></div>'; parseMarket(); } function parseMarket() { var remVisible = ($def || $d.quotes == undefined) ? false : true; var qx = $d.quotes || DBMgr.def.getData().quotes; $m_o += '<div id="cell1" class="content sL-sR sL w1"><span class="label" id="label1"><a href="http://www.nbcnews.com/id/3032222/">Stocks</a><span class="chnglink"><a href="' + Utils.dbx_Change('business') + '" class="chng">Change</a>'; $m_o += (remVisible == true) ? (' / <a href="' + Utils.dbx_Remove('business') + '" class="chng">remove</a>') : ''; $m_o += '</span></span></div><div id="cell2" class="content w2 x1 sL-sR sR label-remove"><span class="label" id="label2"></span><table class="marchart"><thead><tr><th scope="col">Symbol</th><th scope="col">Last</th><th scope="col">Change</th><th scope="col">% change</th></tr></thead><tbody>'; for (var i = 0; i < qx.length; i++) { var m = qx[i]; $m_o += '<tr><td><a href="http://www.nbcnews.com/id/31260763/ns/business-markets?q=' + m.sym + '" title="' + m.name + '">'; if (m.sym == "$DJI" || m.sym == "I:DJI") { m.sname = "DJIA"; } if (m.sym == "$COMP" || m.sym == "I:COMP") { m.sname = "Nasdaq"; } $m_o += m.sname + '</a></td>'; $m_o += '<td>' + m.last + '</td><td class="' + m.arrow + '">' + m.change + '</td><td class="' + m.arrow + '">' + m.pct + '</td></tr>'; }; $m_o += '</tbody></table><p>Quotes delayed 15+ min.</p></div>'; parseSports(); } function parseSports() { if ($d.leagues == undefined || $d.leagues.length == 0) { parseLottery(); return; }; $s_o += '<div id="cell1" class="content sL-sR sL w1"><span class="label" id="label1"><a href="http://www.nbcnews.com/id/3104018/">Scores</a><span class="chnglink"><a href="' + Utils.dbx_Change('sports') + '" class="chng">Change</a> / <a href="' + Utils.dbx_Remove('sports') + '" class="chng">remove</a> </span></span></div><div id="cell2" class="content w2 x1 sL-sR sR label-remove"><span class="label" id="label2"></span>'; for (var i = 0; i < $d.leagues.length; i++) { var s = $d.leagues[i]; $s_o += '<div class="league"><span class="leaguename"><a href="/id/' + s.sf + '/">' + s.name + '</a></span><span class="scoredate"> ' + s.tod + '</span><br />'; if (s.scores.length < 1) { $s_o += '<span class="noscores">No scores to report</span>'; } for (var j = 0; j < s.scores.length; j++) { var sx = s.scores[j]; $s_o += '<table class="scorebox"><thead><tr class="tablehead"><th scope="col">Team</th><th scope="col">Score</th><th $s_o += scope="col">Notes</th></tr></thead><tbody><tr>'; $s_o += '<td class="team"><a href="' + sx.hurl + '">' + sx.hname + '</a></td>'; $s_o += '<td class="score ' + sx.hstatus + '">' + sx.hscore + '</td>'; $s_o += '<td td="status">' + sx.status + '</td></tr><tr>'; $s_o += '<td class="team"><a href="' + sx.vurl + '">' + sx.vname + '</a></td>'; $s_o += '<td class="score ' + sx.vstatus + '">' + sx.vscore + '</td>'; $s_o += '<td td="links"><a href="' + sx.vurl + '">Details</a></td></tr></tbody></table>'; } } $s_o += '</div><!--/league-->'; $s_o += '</div>'; parseLottery(); } function parseLottery() { if ($d.lotto == undefined || $d.lotto.games.length == 0) { parseHoroscope(); return; }; $l_o += '<div id="cell1" class="content sL-sR sL w1"><span class="label" id="label1"><a href="http://www.nbcnews.com/id/14187811">Lottery</a><span class="chnglink"><a href="' + Utils.dbx_Change('local') + '" class="chng">Change</a> / <a href="' + Utils.dbx_Remove('local') + '" class="chng">remove</a> </span></span></div><div id="cell2" class="content w2 x1 sL-sR sR label-remove"><span class="label" id="label2"></span>'; for (var i = 0; i < $d.lotto.games.length; i++) { var l = $d.lotto.games[i]; $l_o += '<div><strong>' + l.name + '</strong><span class="lotdate"> for ' + l.sdte + '</span><br />' + l.nums + '<br />'; $l_o += (l.bonus != '') ? ('Bonus: ' + l.bonus) : ''; $l_o += '</div>'; }; $l_o += '</div>'; parseHoroscope(); } function parseHoroscope() { if ($d.horoscope == undefined) { render(); return; }; $h_o += '<div id="cell1" class="content sL-sR sL w1"><span class="label" id="label1"><a href="http://www.nbcnews.com/id/8404539/">Horoscope</a><span class="chnglink"><a href="' + Utils.dbx_Change('entertainment') + '" class="chng">Change</a> / <a href="' + Utils.dbx_Remove('entertainment') + '" class="chng">remove</a> </span></span></div><div id="cell2" class="content w2 x1 sL-sR sR label-remove"><span class="label" id="label2"></span>'; $h_o += '<div class="horoscope">'; if ($d.horoscope) $h_o += '<strong>' + $d.horoscope.sign + '</strong> ' + $d.horoscope.text; $h_o += '</div></div>'; render(); } function render() { document.getElementById('newstabweather').innerHTML = $w_o; document.getElementById('newstabmarket').innerHTML = $m_o; document.getElementById('newstabsports').innerHTML = $s_o; document.getElementById('newstablottery').innerHTML = $l_o; document.getElementById('newstabhoroscope').innerHTML = $h_o; if ($s_o != '') document.getElementById('newstabsports').style.display = 'block'; if ($l_o != '') document.getElementById('newstablottery').style.display = 'block'; if ($h_o != '') document.getElementById('newstabhoroscope').style.display = 'block'; } function onLoad() { if (DBMgr.getFlavor() == 'default') { $d = DBMgr.def.getData(); $def = true; } else { $d = DBMgr.cookied.getData(); } if (dbxErr != false) { document.getElementById('newstabmarket').style.display = 'none'; document.getElementById('newstabweather').innerHTML = '<div id="cell1" class="content sL-sR sL w1"><span class="label" id="label1"><a href="/">Slight delay</a></span></div><div id="cell2" class="content w2 x1 sL-sR sR label-remove"><span class="label" id="label2"></span><span class="weatherlabel" id="weaErr">Personalized news is currently unavailable, but should return soon. Thank you for your patience.</span></div>'; document.getElementById('weaErr').style.fontWeight = 'normal'; } else if ($d != null) { parseForecast(); } } dxMY.onLoad = onLoad; })(); if (DBMgr.hasLoaded() == true) { dxMY.onLoad(); } else { DBMgr.subscribe(dxMY.onLoad); }