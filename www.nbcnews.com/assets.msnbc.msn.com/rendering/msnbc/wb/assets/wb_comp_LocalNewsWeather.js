if (!("console" in window) || !("firebug" in console)) { var names = ["log", "debug", "info", "warn", "error", "assert", "dir", "dirxml", "group", "groupEnd", "time", "timeEnd", "count", "trace", "profile", "profileEnd"]; window.console = {}; for (var i = 0; i < names.length; ++i) window.console[names[i]] = function () { }; } if (DebugMode == true) { console.log('LN+W slice 4.0.8'); } var dxLNW = {}; (function () { var $d = {}; var $s = {}; var GRID_ID = 23283967; var $grid = {}; var $newslabel_o = ""; var $main_o = ""; var $stories_o = ""; var $wxlabel_o = ""; var $f_o = ""; var $l_o = ""; function CityInitCallbackHandler() { if (!City.l) { return; } if (City.err) { newsLabel(); return; } document.getElementById('localH').className = ''; var LocalNews_dfID = "26400192"; /*default front ID*/var ID = IsNum(City.fID) ? City.fID : LocalNews_dfID; $newslabel_o = 'Local headlines for <a href="/id/' + ID + '?queryCity=' + City.cc + '" title="Local information for ' + City.name + ', ' + City.sc + '">' + City.name + ', ' + City.sc + '</a> from Bing'; var query = "\"" + City.name + "\" " + City.s[0]; LiveSearch.DS(query, 8, LiveSearchCallBackHandler); } function LiveSearchCallBackHandler(d) { var r = d.News.Results; var len = r.length; if (len == 0) { newsLabel(); return; } if (len > 8) len = 8; var source = IsNull(r[0].Source) ? r[0].Url.replace("http://", "").replace("https://", "").split('/')[0].split('.')[1].toUpperCase() : r[0].Source; var sourceurl = IsNull(r[0].Sourceurl) ? "http://" + r[0].Url.replace("http://", "").replace("https://", "").split('/')[0] : r[0].Sourceurl; $main_o = len == 0 ? 'No Stories' : '<h4><a title="' + r[0].Title.replace(/\<strong\>/g, "").replace(/\<\/strong\>/g, "") + '" href="' + r[0].Url + '">' + r[0].Title.replace(/\<strong\>/g, "").replace(/\<\/strong\>/g, "") + '</a></h4><div class="medmax"><p class="abstr"><a class="source" href="' + sourceurl + '"/>' + source + '</a><br/><br/>' + Utils.headTrunc(r[0].Snippet, 108, true) + '</p></div>'; $settings_o = '<a href="' + Utils.dbx_Change('weather') + '" title="Set weather and local news by city name">or choose by city</a>'; for (var i = 1; i < len; i++) { source = (IsNull(r[i].Source) ? r[i].Url.replace("http://", "").replace("https://", "").split('/')[0].split('.')[1].toUpperCase() : r[i].Source); var hs = r[i].Title.replace(/\<strong\>/g, "").replace(/\<\/strong\>/g, "") + " | " + source; hsTrim = Utils.headTrunc(hs, 48, true); if (i > 3) { $stories_o += '<div class="story medmax">'; } else { $stories_o += '<div class="story">'; } $stories_o += '<h6><a href="' + r[i].Url + '" title="' + hs + '">' + hsTrim + '</a></h6></div>'; } /*LiveSearch 'timeliness' error hacks $main_o = '<h4><a href="/">Slight delay</a></h4>'; $stories_o = '<div class="story"><h6 id="LNWerr" style="font-weight: normal;">Local News is currently down for maintenance. Please check back later.</h6></div>'; hacks*/wxLabel(); } function newsLabel() { var l = $d.local || $s.local; $newslabel_o = 'Local headlines for <a href="/id/' + l.sf + '" title="Local information for ' + l.city + '">' + l.city + '</a> from ' + l.affiliate; mainStory(); } function mainStory() { var heads = $d.headlines || $s.headlines; var head = heads[0].headline; /*Utils.headTrunc(heads[0].headline, 28, false);*/var objRegExp = /^(0|[1-9][0-9]*)$/; if (objRegExp.test(heads[0].src) || heads[0].src.indexOf('/ns/') != -1) { $main_o = '<h4><a title="' + heads[0].headline + '" href="/id/' + heads[0].src + '">' + head + '</a></h4><div class="medmax"><p class="abstr">' + Utils.headTrunc(heads[0].abstract, 108, true) + '</p></div>'; } else { $main_o = '<h4><a title="' + heads[0].headline + '" href="' + heads[0].src + '">' + head + '</a></h4><div class="medmax"><p class="abstr">' + Utils.headTrunc(heads[0].abstract, 108, true) + '</p></div>'; } stories(); } function stories() { $stories_o = ''; var heads = $d.headlines || $s.headlines; for (var i = 1; i < heads.length; i++) { var h = heads[i].headline; sh = h; /*Utils.headTrunc(h, 48, true);*/if (i > 3) { $stories_o += '<div class="story medmax">'; } else { $stories_o += '<div class="story">'; } var objRegExp = /^(0|[1-9][0-9]*)$/; if (objRegExp.test(heads[i].src) || heads[i].src.indexOf('/ns/') != -1) { $stories_o += '<h6><a href="/id/' + heads[i].src + '"title="' + h + '">' + sh + '</a></h6></div>'; } else { $stories_o += '<h6><a href="' + heads[i].src + '" title="' + h + '">' + sh + '</a></h6></div>'; } } wxLabel(); } function wxLabel() { var we = $d.weather || $s.weather; $wxlabel_o = 'Forecast for ' + Utils.headTrunc(we.city, 22, false) + ' via <a href="' + makeLink('hourbyhour') + '" target="_blank" title="Hour-by-hour forecast information">weather.com</a>'; makeForecast(); } function makeLink(here) { var pz = Utils.getPersonalization(); var loc = 'USNY0996'; if (pz != undefined && pz.locCode != null) loc = pz.locCode; var pre = "http://msnbc.weather.com/weather/"; var suf = "?par=msnbc&site=msnbc.com&promo=0&cm_ven=MSNBC&cm_cat=www.msnbc.com&cm_pla=WxFront&cm_ite=CityPage"; return pre + here + '/' + loc + suf; } function makeForecast() { $f_o = ""; var isBW = (DBMgr.getFlavor() == 'default') ? ('_bw') : (''); var we = $d.weather || $s.weather; for (var i = 0; i < we.forecast.length; i++) { var f = we.forecast[i]; f.hi = Utils.cleanDate(f.hi); f.lo = Utils.cleanDate(f.lo); if (i > 2) { $f_o += '<span class="condition medmax">'; } else { $f_o += '<span class="condition">'; } f.day = Utils.commaCrop(f.day); $f_o += '<span class="date">' + f.day + '</span>'; f.text = f.text.replace(/(<b>|<\/b>)/g, ''); f.text = f.text.replace(/(<br\s??\/>)/g, ' '); $f_o += '<span class="icon"><a href="/id/18665223/ns/weather-local_weather/" alt="Local weather page for ' + we.city + '"><img title="' + f.text + '" alt="' + f.cond + '" src="http://media1.s-nbcnews.com/i/msnbc/Components/CSS/img/weather/WC' + f.cid + '_small' + isBW + '.jpg"/></a></span>'; var tp = (f.hi != '') ? (f.hi + ' / ' + f.lo) : ('low ' + f.lo); $f_o += '<span class="temps">' + tp + '</span>'; $f_o += '</span>'; }; $f_o += '<span id="weacomlogo" class="condition medmax"><a href="http://msnbc.weather.com/weather/my?par=msnbc&amp;site=msnbcPFP&amp;promo=0&amp;cm_ven=msnbc&amp;cm_cat=www.msnbc.com&amp;cm_pla=PFP&amp;cm_ite=HomePage" target="_blank"><img id="wealogo" alt="Weather.com logo" src="http://media1.s-nbcnews.com/i/msnbc/Components/CSS/img/WeatherDotCom3.gif" name="wealogo"></a></span>'; makeLinks(); } function makeLinks() { $l_o = ""; var hrefs = ["hourbyhour", "tenday"]; var labels = ["Hourly", "10-day"]; $l_o += '<div class="weathercom"><div class="story"><h6><a href="/id/18665223/ns/weather-local_weather/">Detailed</a></h6></div></div>'; for (var i = 0; i < hrefs.length; i++) { if (i > 0) { $l_o += '<div class="weathercom medmax"><div class="story"><h6><a href="' + makeLink(hrefs[i]) + '" target="_blank">'; } else { $l_o += '<div class="weathercom"><div class="story"><h6><a href="' + makeLink(hrefs[i]) + '" target="_blank">'; } $l_o += labels[i] + '</a></h6></div></div>'; }; $l_o += '<div class="weathercom medmax"><div class="story"><h6><a href="/id/18665219/">'; $l_o += 'National map</a></h6></div></div>'; $l_o += '<div class="weathercom"><div class="story"><h6><a href="/id/3032128/ns/weather/">'; $l_o += 'Weather news</a></h6></div></div>'; render(); } function hideEms() { $grid.cell1.className = "content w1 sL label-span"; $grid.localC.className = "nocookie"; $grid.localF.className = "nocookie"; $grid.localW.className = "nocookie"; $grid.localH.className = "nocookie"; $grid.lnw.style.display = 'inline'; var localone = document.getElementById('localone'); localone.style.display = 'none'; $grid.cell1.style.background = 'url("")'; } function render() { $grid.label1.innerHTML = $newslabel_o; $grid.localF.innerHTML = $stories_o; $grid.lo.innerHTML = $main_o; $grid.label3.innerHTML = $wxlabel_o; $grid.localC.childNodes[0].innerHTML = $f_o; $grid.localW.innerHTML = $l_o; if (DBMgr.getFlavor() == 'default' && (City.l != true)) { hideEms(); } setGridHeight('grid_23283967'); } function clearEm(input) { if (input.value != "") { input.value = ""; } } function onLoad() { var root = document.getElementById('grid_' + GRID_ID); $grid.cell1 = root.firstChild; $grid.label1 = root.firstChild.firstChild; $grid.localH = root.firstChild.childNodes[1]; $grid.localF = root.childNodes[1].childNodes[1]; $grid.label3 = root.childNodes[2].firstChild; $grid.localC = root.childNodes[2].childNodes[1]; $grid.localW = root.childNodes[3].childNodes[1]; $grid.lnw = document.getElementById('LNWzipsearch'); $grid.lo = document.getElementById('localone'); if (DBMgr.getFlavor() == 'default') { document.getElementById('localH').className = 'nocookie'; $d = DBMgr.def.getData(); } else { $d = DBMgr.cookied.getData(); $s = DBMgr.def.getData(); if ($d == undefined || IsNull($d.local.sf)) { /*formerly $d.local.city*/$d = $s }; } if (dbxErr == false) { /*live search*/City.Init(CityInitCallbackHandler); if (City.l) { } else { newsLabel(); } } else { var localHede = document.getElementById('localH'); var localErr = document.getElementById('localF'); localHede.innerHTML = '<div class="story"><div id="localone" class="text"><h4><a href="/">Slight delay</a></h4></div></div>'; localErr.innerHTML = '<div class="story"><h6 id="LNWerr">Local news is currently unavailable, but should return soon. Thank you for your patience.</h6></div>'; document.getElementById('LNWerr').style.fontSize = "80%"; document.getElementById('LNWerr').style.fontWeight = "normal"; } } dxLNW.onLoad = onLoad; dxLNW.clearEm = clearEm; dxLNW.hideEms = hideEms })(); if (DBMgr.hasLoaded() == true) { dxLNW.onLoad(); } else { DBMgr.subscribe(dxLNW.onLoad); }