Reuters.utils.loadEchoTrendingStream=function(){var a="",c="";arguments.length>0&&(a=arguments[0],arguments.length>1&&(c="markers:"+arguments[1]+" "));var b=document.getElementById("echo-trending"),d="www",g="12 hours ago";typeof Reuters.info.edition!="undefined"&&Reuters.info.edition.toLowerCase()!="betaus"&&Reuters.info.edition.toLowerCase()!="us"&&(d=Reuters.info.edition.toLowerCase(),g="72 hours ago");Echo.Broadcast.subscribe("Stream.Item.onRender",function(){setDynamicModuleTrackingOnClick("echo-trending")});
new Echo.Stream({target:b,appkey:"dev.reuters.com",query:"scope:http://"+d+".reuters.com"+a+"/* "+c+"-markers:arktan-category-EntertainmentNews,arktan-category-oddlyEnoughNews,arktan-category-sportsNews,arktan-category-olympicsNews,arktan-category-televisionNews,arktan-category-peopleNews,arktan-category-artsNews sanitizeHTML:false type:article after:'"+g+"' -state:ModeratorDeleted,ModeratorFlagged sortOrder:repliesDescending itemsPerPage:4 children:0",viaLabel:{icon:false,text:true},reTag:false,
streamStateLabel:{icon:true,text:true},aggressiveSanitization:true,openLinksInNewWindow:true,contentTransformations:{text:["smileys","hashtags","urls"],html:["smileys","hashtags","urls"],xhtml:["smileys","hashtags","urls"]},plugins:[{name:"ItemAccumulatorDisplay"},{name:"ItemAccumulatorDisplayTweaks"},{name:"LastTweetDate"}]})};Reuters.namespace("stocktwits");Reuters.stocktwits.ricList=[];Reuters.stocktwits.hourlyRicData={};Reuters.stocktwits.dailyRicData={};Reuters.stocktwits.ricCount=1;
dateFormat.masks.chatterTime="mmm d 'at' h:MM tt";dateFormat.masks.chatterTimeHours="h:MM tt";dateFormat.masks.trendingTime="d mmm yyyy',' HH:MM Z";formatDate=function(a){prepDate=a.replace(/([T|Z|:])/g,"-").split("-",6);return origDate=Date.UTC(prepDate[0],prepDate[1]-1,prepDate[2],prepDate[3],prepDate[4],prepDate[5])};
Reuters.stocktwits.trendingRicsHourly=function(a){Reuters.stocktwits.hourlyRicData=a;if(a.response.status==200){if(document.getElementById("trendingTickers")&&a.trends.length>0)for(i=0;i<a.trends.length;i++){var c=a.trends[i];c.ric&&Reuters.stocktwits.ricList.push(c.ric)}Reuters.utils.loadScript("hourlyRicQuotes","/ajax/do/marketDataAjax?type=quote&symbol="+Reuters.stocktwits.ricList.join(",")+"&callback=Reuters.stocktwits.writeRicDataHourly")}else trace("stocktwits error: "+a.errors[0])};
Reuters.stocktwits.writeRicDataHourly=function(){Reuters.stocktwits.writeRicData("hourly")};Reuters.stocktwits.drawChatterModule=function(a,c){Reuters.utils.loadStylesheet("stocktwits-css","/resources_v2/css/widget-stocktwits-featured.css");if(a)Reuters.stocktwits.chatterCount=parseInt(a);trace("companyRic: "+c);c&&Reuters.utils.loadScript("companyChatter","http://api.stocktwits.com/api/streams/ric/"+c+".json?callback=Reuters.stocktwits.singleRicChatter")};
Reuters.stocktwits.singleRicChatter=function(a){trace("singleRicChatter:"+Reuters.stocktwits.ricList);if(a.response.status==200){if(document.getElementById("stocktwitsChatter")&&a.messages.length>0){Reuters.stocktwits.chatterObj=a;if(Reuters.stocktwits.chatterCount>a.messages.length)Reuters.stocktwits.chatterCount=a.messages.length;var c=Reuters.stocktwits.ricList[0],b=a.messages.length>1?"conversations":"conversation",d=Reuters.stocktwits.chatterCount+" recent "+c+" "+b;YAHOO.util.Dom.getAncestorByClassName("stocktwitsChatter",
"column2")&&(d=a.messages.length+' recent <a href="/finance/stocks/social-pulse?symbol='+c+'">'+c+"</a> "+b);b='<div class="module"><div class="moduleHeader"><h4 class="headerTxt">'+d+'</h4></div><div class="moduleBody"><ul id="chatterList">';for(i=0;i<Reuters.stocktwits.chatterCount;i++)d=a.messages[i].message,b+='<li>At <span class="timestamp">'+dateFormat(formatDate(d.created_at),"chatterTimeHours")+'</span><span class="userLogin"><a href="http://stocktwits.com/'+d.platform_user_login+'" target="_blank">'+
d.platform_user_login+"</a></span> wrote:",b+='<div class="chatter-msg"><p>'+linkify(d.body)+"</p></div></li>";b+="</ul>";b+='<div class="moreLink"><a href="/finance/stocks/social-pulse?symbol='+c+'">&#187; All '+c+" conversations</a></div>";b+="</div></div>";b+='<div id="moreRics"><ul><li><span class="moreTitle">MORE: </span><a class="first" href="http://www.reuters.com/finance/stocks/social-pulse?symbol='+Reuters.stocktwits.ricList[1]+'">'+Reuters.stocktwits.ricList[1]+'</a><span class="moreDivider"> | </span></li><li><a href="http://www.reuters.com/finance/stocks/social-pulse?symbol='+
Reuters.stocktwits.ricList[2]+'">'+Reuters.stocktwits.ricList[2]+'</a><span class="moreDivider"> | </span></li><li><a href="http://www.reuters.com/finance/stocks/social-pulse?symbol='+Reuters.stocktwits.ricList[3]+'">'+Reuters.stocktwits.ricList[3]+"</a></li></ul><div>";document.getElementById("stocktwitsChatter").innerHTML=b}}else trace("stocktwits error: "+a.errors[0])};
Reuters.stocktwits.writeRicData=function(a){var a=a=="hourly"?Reuters.stocktwits.hourlyRicData:Reuters.stocktwits.dailyRicData,c=0;for(i=0;i<a.trends.length;i++){var b=a.trends[i];if(b.ric&&quote[b.ric]){currentData=quote[b.ric];var d=currentData.positiveChange=="true"?"Up":"Down",g=b["12_hourly_trend_bar_url_orange"];trace("t: "+b["12_hourly_trend_bar_url_orange"]);var f=quote[b.ric],h=f?"/finance/stocks/social-pulse?symbol="+b.ric:"http://www.stocktwits.com/symbol/"+b.symbol,j=f?"":"_blank",f=f?
f.company:"",e="";e+='<div class="trending-item">';currentData.quote!="--"&&(e+='<div class="ricData"><div class="price">'+currentData.quote+"</div>",e+='<div class="change change'+d+'">$'+currentData.netChange+"("+currentData.percentChange+")</div></div>");e+=Reuters.info.edition.toLowerCase()=="uk"?'<h4><a href="/business/quotes/social-pulse?symbol='+b.ric+'">'+f+"&nbsp;("+b.ric+")</a></h4>":'<h4><a href="/finance/stocks/social-pulse?symbol='+b.ric+'">'+f+"&nbsp;("+b.ric+")</a></h4>";e+='<div class="timestamp">'+
dateFormat(formatDate(b.updated_at),"trendingTime")+"</div>";e+="</div>";trace("chart:"+g);e+='<div class="chart staticBg"><div class="chartbg"><a href="'+h+'" target="'+j+'"><img src="'+g+'"/></a></div></div>';e+='<div id="stocktwitsChatter"></div>';Reuters.stocktwits.drawChatterModule("1",b.ric);document.getElementById("trendingTickersCol1").innerHTML+=e;c++;if(c==Reuters.stocktwits.ricCount)break}}setDynamicModuleTrackingOnClick("trendingTickers")};
Reuters.stocktwits.init=function(){Reuters.utils.loadScript("trendingRicsHourly","http://api.stocktwits.com/api/symbols/trending/hourly.json?asset=equities&limit=5&callback=Reuters.stocktwits.trendingRicsHourly")};
function linkify(a){a+=" ";replacedText=a.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>');replacedText=replacedText.replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>');return replacedText=replacedText.replace(/(\$)([A-Za-z]+)(?=\s|\Z|[,.:;\?!]*)/gim,'<a href="http://www.stocktwits.com/symbol/$2" target="_blank">$1$2</a>')};
